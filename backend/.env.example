# Server Configuration
PORT=8080
HOST=0.0.0.0

# CORS Configuration
CORS_ALLOWED_ORIGINS=http://localhost:3000,http://localhost:3001
CORS_ALLOWED_METHODS=GET,POST,PUT,DELETE,OPTIONS
CORS_ALLOWED_HEADERS=Content-Type,Authorization

# Git Configuration
GIT_TERMINAL=dumb
GIT_ASKPASS=echo
GIT_SSH_COMMAND=ssh -o StrictHostKeyChecking=no

# Temporary Directory
TEMP_DIR=/tmp/chartimpact

# Timeouts (in seconds)
COMPARE_TIMEOUT=120
VERSIONS_TIMEOUT=60
GIT_CLONE_TIMEOUT=120
HELM_TIMEOUT=60

# Logging
LOG_LEVEL=info
LOG_FORMAT=json

# Diff Engine Configuration
# INTERNAL_DIFF_ENABLED: Set to true to use the internal diff engine (recommended, default)
# The internal diff engine provides better performance, semantic understanding, and structured output
# without requiring external dependencies.
INTERNAL_DIFF_ENABLED=true

# DEPRECATED: The following settings are deprecated and will be removed in a future version
# DYFF_ENABLED: Controls dyff usage (only applies when INTERNAL_DIFF_ENABLED=false)
# Falls back to simple diff if dyff is not available
# WARNING: Disabling the internal diff engine is not recommended
# Default is now false since dyff is deprecated
# DYFF_ENABLED=false

# ============================================================================
# Storage & Analytics Configuration (Optional - Feature Flag)
# ============================================================================
# Enable persistent storage of comparison results for replay and analytics
# Set to 'true' to enable storage, 'false' to disable (default: false)
# When disabled, ChartImpact works normally but without result persistence
STORAGE_ENABLED=false

# Storage Type
# Choose between 'disk' (ephemeral disk-only) or 'postgres' (persistent database)
# Default: postgres
# 
# - disk: Simple file-based storage with no memory caching, startup-only cleanup
#         Suitable for lightweight deployments without database requirements
#         Results stored as JSON files, deleted on expiration or startup cleanup
#         
# - postgres: Full-featured database storage with compression and analytics
#             Suitable for production deployments requiring analytics and history
STORAGE_TYPE=postgres

# ============================================================================
# Disk Storage Configuration (when STORAGE_TYPE=disk)
# ============================================================================
# Directory to store result files (default: /data/results)
# Ensure this directory is writable by the application
# Can be deleted entirely without issues - ephemeral by design
DISK_STORAGE_DIR=/data/results

# Result Retention (days)
# Number of days to retain stored comparison results (default: 30)
# Results older than this will be deleted during startup cleanup
# Set to 0 to keep results indefinitely (not recommended)
RESULT_TTL_DAYS=30

# Maximum Disk Usage (MB)
# Optional: Maximum disk space to use for result storage (default: 0 = no limit)
# When exceeded during startup cleanup, oldest results are deleted first
# Example: 1024 for 1GB limit, 512 for 512MB limit
# Set to 0 to disable disk usage limit
MAX_DISK_USAGE_MB=0

# ============================================================================
# PostgreSQL Storage Configuration (when STORAGE_TYPE=postgres)
# ============================================================================
# Database Connection
# PostgreSQL connection string for storing comparison results
# Format: postgres://username:password@host:port/database?sslmode=disable
# Example: postgres://chartimpact:chartimpact@localhost:5432/chartimpact?sslmode=disable
# DATABASE_URL=postgres://chartimpact:chartimpact@localhost:5432/chartimpact?sslmode=disable

# Database Connection Pool
# Maximum number of open connections to the database (default: 25)
# Adjust based on your database capacity and expected concurrent load
DB_MAX_CONNECTIONS=25

# ============================================================================
# Notes on Storage Feature:
# ============================================================================
# When STORAGE_ENABLED=true with STORAGE_TYPE=disk:
# - Results stored as JSON files in DISK_STORAGE_DIR
# - No in-memory caching (disk reads on every access)
# - No background cleanup (only at startup)
# - Atomic writes prevent corruption
# - Safe to delete entire directory
# - No analytics support
# - Suitable for: lightweight deployments, temporary caching, simple setups
#
# When STORAGE_ENABLED=true with STORAGE_TYPE=postgres:
# - Results stored in PostgreSQL with gzip compression
# - Full analytics and reporting features
# - Background cleanup with pg_cron
# - Deduplication and content hashing
# - Suitable for: production, analytics, long-term storage
#
# See STORAGE_SPEC.md for complete documentation
